<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WebMCP Demo</title>
    <style>
        body {
            font-family: system-ui, Segoe UI, Roboto, Arial;
            margin: 24px
        }

        button,
        input {
            margin: 6px 0;
            padding: 8px
        }

        pre {
            background: #f6f8fa;
            padding: 12px;
            border-radius: 6px
        }
    </style>
    <script src="https://unpkg.com/@mcp-b/global@latest/dist/index.iife.js"></script>
</head>

<body>
    <h1>WebMCP Demo</h1>
    <p>Three simple tools registered in-page:</p>
    <ul>
        <li><strong>random</strong> — returns a random number in [0,1).</li>
        <li><strong>addText</strong> — stores provided text in <code>localStorage</code>.</li>
        <li><strong>getTexts</strong> — returns the stored list of texts.</li>
    </ul>

    <section>
        <h3>Invoke tools</h3>
        <div>
            <button id="call-random">Call <strong>random</strong></button>
            <pre id="random-out">—</pre>
        </div>

        <div>
            <input id="text-input" placeholder="Text to store" style="width:60%">
            <button id="call-add">Call <strong>addText</strong></button>
        </div>
        <div>
            <button id="call-get">Call <strong>getTexts</strong></button>
            <pre id="get-out">—</pre>
        </div>
    </section>

    <script>
        // Minimal in-page WebMCP-like registry for demo purposes.
        (function () {
            // Define shared functions for registry updates and UI updates
            function updateRandomText() {
                const randomValue = Math.random();
                const result = {
                    content: [{ type: 'text', text: `Random number: ${randomValue}` }]
                };
                document.getElementById('random-out').textContent = result.content[0].text;
                return result;
            }

            function addTextToStorage(text) {
                const key = 'webmcp_texts';
                const raw = localStorage.getItem(key);
                const arr = raw ? JSON.parse(raw) : [];
                arr.push(String(text));
                localStorage.setItem(key, JSON.stringify(arr));
                const result = {
                    content: [{ type: 'text', text: `Text added. Current length: ${arr.length}` }]
                };
                document.getElementById('get-out').textContent = result.content[0].text;
                return result;
            }

            function getTextsFromStorage() {
                const raw = localStorage.getItem('webmcp_texts');
                const texts = raw ? JSON.parse(raw) : [];
                const result = {
                    content: [{ type: 'text', text: `Stored texts: ${texts.join(', ')}` }]
                };
                document.getElementById('get-out').textContent = result.content[0].text;
                return result;
            }

            // Update MCP registry
            navigator.modelContext.registerTool({
                name: 'random',
                description: 'Return random number',
                inputSchema: {
                    type: 'object',
                    properties: {} // No input expected
                },
                execute: async () => updateRandomText()
            });

            navigator.modelContext.registerTool({
                name: 'addText',
                description: 'Append text to localStorage list',
                inputSchema: {
                    type: 'object',
                    properties: {
                        text: { type: 'string', description: 'Text to store' }
                    },
                    required: ['text']
                },
                execute: async ({ text }) => {
                    if (!text) {
                        return {
                            content: [{
                                type: 'text',
                                text: 'Error: Missing required parameter "text".'
                            }],
                            isError: true
                        };
                    }
                    return addTextToStorage(text);
                }
            });

            navigator.modelContext.registerTool({
                name: 'getTexts',
                description: 'Get stored texts',
                inputSchema: {
                    type: 'object',
                    properties: {} // No input expected
                },
                execute: async () => getTextsFromStorage()
            });

            // Wire up UI
            document.getElementById('call-random').addEventListener('click', () => {
                updateRandomText();
            });

            document.getElementById('call-add').addEventListener('click', () => {
                const txt = document.getElementById('text-input').value;
                addTextToStorage(txt);
                document.getElementById('text-input').value = '';
            });

            document.getElementById('call-get').addEventListener('click', () => {
                getTextsFromStorage();
            });
        })();
    </script>
</body>

</html>